<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.pinmarket.mapper.product.ProductMapper">
	
	<select id="getProductList" resultType="com.pinmarket.vo.ProductVO">
		select * from PRODUCT_TB
	</select>
	
	<insert id="createOrder">
		INSERT INTO ORDER_TB (ID, MEMBER_ID, PRODUCT_ID, STATUS) 
		VALUES(SEQ_ORDER_TB_ID.nextval,#{member_id},#{product_id},'wait')
		
		<selectKey order="AFTER" resultType="int" keyProperty="id">
			SELECT SEQ_ORDER_TB_ID.currval FROM dual
		</selectKey>
	</insert>
	
	<update id="addOrder_id">
		UPDATE ORDER_TB SET ORDER_ID = #{order_id}
		WHERE ID = #{id}
	</update>
	
	<update id="updateStatus">
		UPDATE ORDER_TB SET 
		CARD_NUM 		= 	#{card_num}, 
		PRODUCT_NAME 	= 	#{product_name}, 
		METHOD_TYPE 	= 	#{method_type}, 
		PG_TYPE 		= 	#{pg_type}, 
		RECEIPT_ID		=	#{receipt_id},
		PRICE			=	#{price},
		REQUESTED_AT	=	TO_DATE(#{requested_at},'yyyy-MM-dd hh24:mi:ss'),
		PURCHASED_AT	=	TO_DATE(#{purchased_at},'yyyy-MM-dd hh24:mi:ss')
		WHERE ORDER_ID 	= 	#{order_id}
	</update>
	
	<select id="getOrder" resultType="com.pinmarket.vo.OrderVO">
		SELECT * FROM ORDER_TB WHERE RECEIPT_ID = #{receipt_id}
	</select>
	
	<update id="OrderStatusUpdate">
		UPDATE ORDER_TB SET STATUS = #{status}
		WHERE RECEIPT_ID = #{receipt_id}
	</update>
	
</mapper>